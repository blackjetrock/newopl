MALARM:
LOCAL ADDR%,ALRM%
LOCAL CMINS,LMINS

REM RETURNS MINUTES TO FIRST ALARM OR 9E99 IF NO ALARM

ADDR%=$22F9
LMINS=9E99
DO
 IF (PEEKB(ADDR%+5) AND 1)=1
  CMINS=DAYS(PEEKB(ADDR%+2)+1,PEEKB(ADDR%+1)+1,PEEKB(ADDR%)+1900)*1440+PEEKB(ADDR%+3)*60+PEEKB(ADDR%+4)
  IF CMINS<LMINS
   LMINS=CMINS
  ENDIF
 ENDIF
 ADDR%=ADDR%+6
 ALRM%=ALRM%+1
UNTIL ALRM%=8
RETURN LMINS-(DAYS(DAY,MONTH,YEAR)*1440+HOUR*60+MINUTE)
