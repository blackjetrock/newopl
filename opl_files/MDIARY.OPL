MDIARY:
LOCAL ADDR%,LEN%
ADDR%=PEEKW($2004)

REM RETURNS MINUTES TO FIRST DIARY ALARM OR 9E99 IF NO ALARM

LEN%=PEEKB(ADDR%)
WHILE LEN%<>0
 IF (PEEKB(ADDR%+6))>0
  RETURN (DAYS(PEEKB(ADDR%+3)+1,PEEKB(ADDR%+2)+1,PEEKB(ADDR%+1)+1900)*1440+PEEKB(ADDR%+4)*60+PEEKB(ADDR%+5)-PEEKB(ADDR%+6)+1)-(DAYS(DAY,MONTH,YEAR)*1440+HOUR*60+MINUTE)
 ENDIF
 ADDR%=ADDR%+7+LEN%
 LEN%=PEEKB(ADDR%)
ENDWH
RETURN 9E99
